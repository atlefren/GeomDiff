using System.Collections.Generic;
using GeoAPI.Geometries;
using GeomDiff;
using NUnit.Framework;

namespace Test
{
    internal class GeomPair
    {
        public string Name { get; set; }
        public IGeometry OldGeometry { get; set; }
        public IGeometry NewGeometry { get; set; }
    }

    [TestFixture]
    public class RoundtripTests : TestBase
    {
       

        private readonly List<GeomPair> pairs = new List<GeomPair>()
    {
        new GeomPair()
        {
            Name = "XY point modify",
            OldGeometry = ReadWkt("POINT(1 2)"),
            NewGeometry = ReadWkt("POINT(2 1)")
        },
        new GeomPair()
        {
            Name = "XY point Insert",
            OldGeometry = null,
            NewGeometry = ReadWkt("POINT(2 1)")
        },
        new GeomPair()
        {
            Name = "XY point Delete",
            OldGeometry = ReadWkt("POINT(1 2)"),
            NewGeometry = null
        },
        new GeomPair()
        {
            Name = "XYZ point Modify",
            OldGeometry = ReadWkt("POINT(1 2 0)"),
            NewGeometry = ReadWkt("POINT(2 1 10)"),
        },
        new GeomPair()
        {
            Name = "XY Linestring Modify",
            OldGeometry = ReadWkt("LINESTRING(0 0, 1 1, 2 2)"),
            NewGeometry = ReadWkt("LINESTRING(0 0, 1 1, 3 1)"),
        },
        new GeomPair()
        {
            Name = "XY Linestring Modify insert",
            OldGeometry = ReadWkt("LINESTRING(0 0, 1 1, 2 2)"),
            NewGeometry = ReadWkt("LINESTRING(0 0, 1 1, 1.5 1.5, 2 2)"),
        },
        new GeomPair()
        {
            Name = "XY Linestring Modify delete",
            OldGeometry = ReadWkt("LINESTRING(0 0, 1 1, 1.5 1.5, 2 2)"),
            NewGeometry = ReadWkt("LINESTRING(0 0, 1 1, 2 2)"),
        },
        new GeomPair()
        {
            Name = "XY Linestring Modify delete end",
            OldGeometry = ReadWkt("LINESTRING(0 0, 1 1, 2 2, 3 3)"),
            NewGeometry = ReadWkt("LINESTRING(0 0, 1 1, 2 2)"),
        },
        new GeomPair()
        {
            Name = "XY Linestring Modify delete start",
            OldGeometry = ReadWkt("LINESTRING(0 0, 1 1, 2 2, 3 3)"),
            NewGeometry = ReadWkt("LINESTRING(1 1, 2 2, 3 3)"),
        },
        new GeomPair()
        {
            Name = "XY Linestring Modify insert",
            OldGeometry = ReadWkt("LINESTRING(1 1, 2 2, 3 3, 4 4)"),
            NewGeometry = ReadWkt("LINESTRING(0 0, 1 1, 2.5 2.5, 3 3, 4 4)"),
        },
        new GeomPair()
        {
            Name = "XY Linestring Modify insert 2",
            OldGeometry = ReadWkt("LINESTRING(0 0, 2 2, 3 3, 4 4)"),
            NewGeometry = ReadWkt("LINESTRING(0 0, 10 10, 2.5 2.5, 3 3, 4 4)"),
        },
        new GeomPair()
        {
            Name = "Linestring Insert",
            OldGeometry = null,
            NewGeometry = ReadWkt("LINESTRING(1 1 1, 2 2 2, 3 3 3)"),
        },new GeomPair()
        {
            Name = "Linestring delete",
            OldGeometry = ReadWkt("LINESTRING(1 1 1, 2 2 2, 3 3 3)"),
            NewGeometry = null,
        },
        new GeomPair()
        {
            Name = "Linestring, real life 2",
            OldGeometry =  ReadWkt(@"LINESTRING(
            10.389584878580221 63.38379462924338 , 
            10.389585508423401 63.383794976157404 ,
            10.389609472532209 63.383811126200484 ,
            10.389640883631847 63.38383254134925 ,
            10.389641818792885 63.38383359730583 ,
            10.389642404166752 63.3838337363236 ,
            10.389651732257262 63.38383908420184 ,
            10.389661108395133 63.38384347111088 ,
            10.389693822452342 63.3838522088655 ,
            10.389708950445081 63.38385855785486 ,
            10.390051101248217 63.38421432984811 ,
            10.39042264341937 63.38416439342289 ,
            10.390820737335034 63.38448304000912
            )"),
            NewGeometry = ReadWkt(@"LINESTRING(
            10.38958185970921 63.38380334822034 ,
            10.389593067155072 63.38380461406387 ,
            10.389609472532209 63.383811126200484 ,
            10.389640883631847 63.38383254134925 ,
            10.389642361495515 63.38383371387188 ,
            10.389650993486136 63.38383717289713 ,
            10.389660044160552 63.3838385841412 ,
            10.390019737977763 63.38420623340159 ,
            10.390051101248217 63.38421432984811 ,
            10.39024633332992 63.384326765058375 ,
            10.390820737335034 63.38448304000912
        )")
        },
        new GeomPair()
        {
            Name = "Linestring, real life 3",
            OldGeometry =  ReadWkt(@"LINESTRING(
            10.519858499297726 63.34300994936554,
            10.519859513429243 63.343009950349106,
            10.519860007523878 63.34300980236046,
            10.519861774458736 63.34300979138081,
            10.519863494438919 63.343009474566934,
            10.519864720866051 63.34300887979255,
            10.519870681224093 63.34300851534551,
            10.519871637049489 63.34300824431286,
            10.519873350039129 63.34300827861312,
            10.51987512116326 63.3430064606189,
            10.51988747894407 63.343004745112594,
            10.519890262838688 63.34300576626007,
            10.519891424168495 63.343006275944994,
            10.519904591798966 63.34301535874093,
            10.519920303240529 63.343012110135014,
            10.519938543022713 63.34301978203005,
            10.51994552379408 63.34301984434887,
            10.519991090099273 63.343030080218085,
            10.52015148725139 63.34304873842197,
            10.520165258025164 63.343050401682284,
            10.520232647395282 63.34309023295808,
            10.520245137437934 63.34309114794628,
            10.520249349267802 63.343093049547825,
            10.520265657720321 63.3430943417384,
            10.52026700165042 63.34309517245952,
            10.5203481337724 63.34308515082503
        )"),
            NewGeometry = ReadWkt(@"LINESTRING(
            10.51998330819986 63.34302407453306,
            10.520165258025164 63.343050401682284,
            10.52024666185635 63.34309199393601,
            10.520267034022387 63.34309527600748
        )")
        },
        new GeomPair()
        {
            Name = "Linestring, real life 4",
            OldGeometry =  ReadWkt(@"LINESTRING(
                10.330312958408104 63.35452300051842 ,
                10.33031121611267 63.354521803131455 ,
                10.330284871160705 63.35450371150445 ,
                10.33024203477283 63.354484275630725 ,
                10.33020620039904 63.35448782560227 ,
                10.330198265304908 63.35449166571304 ,
                10.330196955328402 63.35449207062874 ,
                10.330086958065781 63.3543321751539 ,
                10.330001023491093 63.354238014819195 ,
                10.329921532684434 63.35423181686299 ,
                10.329921393889581 63.35423171061769 ,
                10.329921370366623 63.35423168693956 ,
                10.329891335506616 63.354211822399506 ,
                10.329888551924146 63.35421060901952
            )"),
            NewGeometry = ReadWkt(@"LINESTRING(
            10.330310829818236 63.35451414232896 ,
            10.330116063130953 63.35437857828754 ,
            10.330086958065781 63.3543321751539 ,
            10.329921393889581 63.35423171061769 ,
            10.329891335506616 63.354211822399506
        )")
        },
        new GeomPair()
        {
            Name = "Linestring, real life 5",
            OldGeometry =  ReadWkt(@"LINESTRING(5.7612139 58.8132158,5.7610411 58.8131398,5.7601186 58.8127566,5.7598967 58.8125354,5.759092 58.8122455,5.7590735 58.8120743,5.7593205 58.8120266,5.7596665 58.8119371,5.7597644 58.8119119,5.7585559 58.8114951,5.7571237 58.8110636,5.7568003 58.8110016,5.7567447 58.8110223,5.7560502 58.8112801,5.7559389 58.8113214,5.7555422 58.8113024,5.7554113 58.8112183,5.7554467 58.8111044,5.7554612 58.8110577,5.7555443 58.8110171,5.7559694 58.8108099,5.7561857 58.8107532,5.7575676 58.8103917,5.758127 58.8105226,5.7585647 58.8106594,5.759179 58.8109445,5.7597033 58.8110835,5.7599655 58.8110541,5.7599968 58.811033,5.7601692 58.8109154,5.7601678 58.8107446,5.760113 58.8106623,5.7600767 58.8106076,5.7601149 58.8103838,5.7606691 58.8102,5.7612347 58.8100794,5.7616712 58.8098567,5.7620999 58.8099034,5.7622674 58.809872,5.7623704 58.8098527,5.7624829 58.8096973,5.763361 58.8091981,5.7638728 58.8086785,5.7638967 58.8086544,5.7640977 58.8085426,5.7643197 58.8085996,5.7643684 58.8086122,5.7647985 58.8088297,5.7651075 58.808856,5.7652455 58.8088679,5.7665889 58.8096282,5.7669402 58.8098271,5.7669451 58.8100465,5.7669461 58.8100861,5.7669503 58.8102768,5.767221 58.8103465,5.767691 58.8103223,5.7689729 58.8099499,5.7709699 58.8097124,5.7719981 58.8094595,5.7727203 58.809145,5.7728019 58.8090123,5.7726884 58.8089286,5.772592 58.8089074,5.7723659 58.8088576,5.7720978 58.8089293,5.7716908 58.8090384,5.7711325 58.8092671,5.7709646 58.8092887,5.7709572 58.8092897,5.7707633 58.8092583,5.7705647 58.8092259,5.7698595 58.8091754,5.7697903 58.8091706,5.7690819 58.8084068,5.7694243 58.8082626,5.7702014 58.8081024,5.7702139 58.808098,5.770703 58.8079262,5.7716537 58.8077612,5.7706948 58.8069656,5.7687498 58.8053517,5.7682673 58.8049511,5.7681803 58.8048791,5.7682056 58.8048072,5.7682275 58.8047454,5.7689502 58.8046108,5.7691369 58.8046514,5.7692498 58.8047492,5.7695215 58.8049845,5.7695272 58.8049864,5.7697908 58.8050723,5.7701256 58.8050087,5.7701413 58.805002,5.7703422 58.8049152,5.7704966 58.8046441,5.7705493 58.804552,5.7707112 58.8039269,5.7706719 58.8037911,5.7706626 58.8036076,5.7706598 58.8035482,5.7705895 58.8033897,5.770531 58.8032573,5.7706999 58.8031178,5.7708718 58.8030555,5.7712556 58.8029159,5.7712534 58.8028571,5.7712508 58.802781,5.770865 58.8026456,5.7702067 58.8026471,5.7695226 58.8029264,5.7691422 58.8031057,5.7690297 58.8031064,5.7688476 58.8031072,5.7677233 58.8027656,5.7673653 58.8026567,5.765757 58.8024456,5.7655803 58.8022974,5.7655494 58.8022042,5.7654859 58.8021962,5.7653073 58.8020659,5.7653875 58.801951,5.7655686 58.8018657,5.7658597 58.8018233,5.7660426 58.8017967,5.7664162 58.8017077,5.7665207 58.8016829,5.7665519 58.8016844,5.7673871 58.8016776,5.7675532 58.8015425,5.7676122 58.8014945,5.7677832 58.8009648,5.7678799 58.8006654,5.7683716 58.8,5.768395 58.7999683,5.7683946 58.7999612,5.768388 58.7996714,5.7682702 58.7995412,5.7682467 58.7995152,5.7681956 58.7993519,5.7681654 58.7992557,5.7681131 58.7990895,5.767896 58.7990031,5.7673671 58.798918,5.7671389 58.7988544,5.7664723 58.7986708,5.766255 58.7985845,5.7662444 58.7985123,5.766428 58.7984001,5.7665091 58.7980876,5.7667881 58.7975777,5.7668666 58.7974155,5.7668956 58.7973287,5.7669467 58.7972316,5.7669396 58.7972247,5.7668498 58.7971416,5.7666846 58.7971047,5.7665355 58.7971229,5.7666053 58.7972777,5.7666142 58.7974092,5.7664045 58.797353,5.7659325 58.7972608,5.7643223 58.7975834,5.7628055 58.797689,5.7628591 58.7978612,5.7630274 58.7980339,5.7632544 58.7982666,5.7633065 58.7984476,5.7627812 58.798695,5.7626086 58.7988079,5.7622648 58.7990326,5.7621892 58.7991026,5.7614541 58.7993717,5.761244 58.7995821,5.7609975 58.8,5.7609148 58.8001401,5.7608945 58.8001535,5.760601 58.8003479,5.7604921 58.8003161,5.7604324 58.8002988,5.7603788 58.8002344,5.7601839 58.8000001,5.7600277 58.7998122,5.7594659 58.7995195,5.7591737 58.7996829,5.75896 58.8,5.7587242 58.8003498,5.7583696 58.800876,5.7582782 58.8009277,5.7584337 58.8010298,5.75862 58.8011522,5.7589452 58.8012051,5.759236 58.8013165,5.759246 58.8013205,5.7594014 58.8013196,5.760719 58.8013126,5.7611029 58.8014661,5.7614111 58.8016895,5.7608777 58.8021026,5.7608264 58.8021425,5.7607965 58.8022945,5.7611943 58.802701,5.7612112 58.802718,5.7613313 58.8028197,5.761452 58.8029218,5.7614236 58.8030537,5.7613965 58.8031814,5.7613545 58.803236,5.7611356 58.8033452,5.7607959 58.8034961,5.7606672 58.8034967,5.7603566 58.8034982,5.7591121 58.8035044,5.758967 58.803502,5.7587979 58.8035571,5.7584184 58.8036809,5.7582865 58.8037396,5.757947 58.8037325,5.7576525 58.8036642,5.7576517 58.8035543,5.7578321 58.8033754,5.758111 58.8030986,5.7582437 58.802967,5.7581483 58.8028747,5.7573553 58.8026672,5.7570692 58.80321,5.7570547 58.8032374,5.7568875 58.8035546,5.756886 58.8035576,5.7568738 58.8035809,5.7568323 58.8036319,5.7568061 58.8036646,5.7566692 58.803834,5.7563055 58.8043838,5.7567127 58.8041614,5.756819 58.8040915,5.7569517 58.804004,5.7572701 58.8040612,5.7573185 58.8041606,5.7573262 58.8042408,5.7571697 58.8044498,5.7569007 58.8047318,5.7567728 58.8048659,5.7565505 58.8050379,5.7561696 58.8053325,5.7557737 58.8053045,5.7556438 58.8052114,5.7556246 58.8050276,5.7557031 58.8049571,5.7553431 58.8049072,5.7548194 58.8051367,5.7545576 58.8051571,5.75426 58.8050058,5.7541194 58.8050023,5.7540354 58.8050002,5.7538252 58.8052106,5.7537529 58.8056133,5.7535457 58.8059765,5.7535431 58.8060398,5.7534972 58.8071287,5.753489 58.8073232,5.7533058 58.8076151,5.7529238 58.8078123,5.7527001 58.8078461,5.7524141 58.8078893,5.7514435 58.8079177,5.751424 58.8079183,5.7513077 58.807973,5.7512428 58.8080036,5.7511215 58.8081893,5.7509445 58.8082298,5.7504649 58.807984,5.7500158 58.8079727,5.7500002 58.8079434,5.7497205 58.807426,5.7493942 58.807211,5.749279 58.8067767,5.7491648 58.8065847,5.7489648 58.8062475,5.7488114 58.8058625,5.7487405 58.8056845,5.7487221 58.8053248,5.7490723 58.8050998,5.7500001 58.8049872,5.7500001 58.8044529,5.7496252 58.8045353,5.749539 58.8045544,5.7493595 58.8046217,5.74885 58.8046988,5.7483628 58.8047224,5.7480622 58.8047867,5.7475899 58.8048377,5.7469864 58.8049934,5.7463428 58.805022,5.7457406 58.8049798,5.7454801 58.8048025,5.7455167 58.8045967,5.7457959 58.8040195,5.7458042 58.8039299,5.7459026 58.8036486,5.7459227 58.8035913,5.7459002 58.8035613,5.745738 58.803344,5.7455747 58.8032238,5.7454546 58.8031354,5.745354 58.8030615,5.7452195 58.8029624,5.7452188 58.8029205,5.7452165 58.8028096,5.7454677 58.802717,5.7465601 58.8028884,5.7476794 58.8027728,5.7482496 58.8027872,5.7482497 58.8027711,5.7482537 58.8023739,5.7476763 58.8022515,5.7471043 58.8018865,5.7466763 58.8018308,5.74663 58.8018211,5.7460991 58.8017084,5.7452782 58.8015978,5.7450608 58.8016443,5.7449777 58.8016621,5.7443739 58.8020064,5.7439432 58.8021663,5.7435604 58.8021836,5.7434232 58.8021288,5.7429596 58.8019437,5.7427055 58.8018833,5.7417719 58.8014883,5.7416893 58.8014532,5.7413633 58.8014001,5.741297 58.8013894,5.7412849 58.8013946,5.7410804 58.8014828,5.7411626 58.8015298,5.74118 58.801578,5.7412591 58.8017929,5.7414685 58.8021622,5.7416156 58.8024219,5.7414729 58.8026539,5.7414521 58.8026875,5.7412445 58.802871,5.7409718 58.8032282,5.7409483 58.8032589,5.7407298 58.8033703,5.7403834 58.8033705,5.7400414 58.8033259,5.7393829 58.8033273,5.7393983 58.8035343,5.7394375 58.8036702,5.7391286 58.8038241,5.7384903 58.8038304,5.7381056 58.8038342,5.7380167 58.8038966,5.7379199 58.8039644,5.7376694 58.8042366,5.7374199 58.8043112,5.7370247 58.804463,5.7368343 58.8047437,5.7367432 58.8048782,5.7363719 58.8047941,5.7360638 58.8052616,5.7360188 58.805439,5.733685 58.8060597,5.7330182 58.805579,5.7322523 58.8053316,5.7325406 58.8048322,5.7323875 58.8046782,5.7321 58.8047763,5.7320579 58.8047866,5.7311534 58.8051951,5.7307921 58.8052845,5.7307582 58.8052929,5.7306923 58.8053092,5.7300129 58.805166,5.7288964 58.8043289,5.7286259 58.8042591,5.7284982 58.8042928,5.7282529 58.8043575,5.727589 58.8046617,5.7275652 58.8046726,5.7272663 58.8048444,5.7265763 58.8052407,5.7266772 58.8053197,5.7268021 58.8054172,5.7268605 58.8054357,5.7270184 58.8054857,5.7273571 58.8055931,5.7274886 58.8056682,5.7280145 58.8059693,5.7288861 58.806279,5.7295334 58.8063943,5.7301523 58.8060655,5.7302676 58.8060041,5.7302754 58.806,5.7305181 58.805871,5.7316053 58.8057278,5.7316553 58.8057415,5.731859 58.8057971,5.7319911 58.8058634,5.7320788 58.8060364,5.7319972 58.8060917,5.7317458 58.8062616,5.7316427 58.8062908,5.7314255 58.8063524,5.7313266 58.8064881,5.7310275 58.8068995,5.7310237 58.8071241,5.7311836 58.8072085,5.7312382 58.8072374,5.7316331 58.8072744,5.7320318 58.8074553,5.7322379 58.8076581,5.732244 58.8077404,5.7323072 58.8085768,5.7324911 58.8086227,5.7327474 58.8086867,5.7343802 58.8082697,5.7345494 58.8082711,5.7348996 58.808274,5.7354369 58.8084371,5.7356743 58.8085092,5.7363698 58.8088504,5.7368213 58.8090235,5.7370362 58.8090327,5.7372586 58.8090422,5.7373965 58.8089576,5.7374127 58.8089478,5.7375096 58.8088882,5.737641 58.8089034,5.7379035 58.8089341,5.7382936 58.8090248,5.7386402 58.8090246,5.7389707 58.8089572,5.7389931 58.8089527,5.7389945 58.8089547,5.7392732 58.8089238,5.7393502 58.8090201,5.7394127 58.8090981,5.7392439 58.8092376,5.7392536 58.8096873,5.7388711 58.8098842,5.7389124 58.8101819,5.7390929 58.8104741,5.7402413 58.8103597,5.7415329 58.8102296,5.7416748 58.8105757,5.7419805 58.8108109,5.7422425 58.8109692,5.7424433 58.8110777,5.7426442 58.8111636,5.7429499 58.811349,5.7430023 58.8113897,5.7430721 58.8114078,5.7431427 58.8114393,5.7435763 58.8114322,5.7439622 58.8115677,5.7443355 58.8116492,5.7450827 58.8118118,5.7458425 58.8120097,5.7460411 58.8120614,5.7478731 58.8125383,5.7480649 58.812725,5.7478731 58.8125383,5.7480649 58.812725,5.7484164 58.8130448,5.7480649 58.812725,5.7484164 58.8130448,5.74869 58.8129781,5.7495483 58.8128281,5.7499721 58.8133531,5.7501616 58.81347,5.7499721 58.8133531,5.7501616 58.81347,5.7504462 58.8134742,5.7512133 58.8134794,5.751306 58.8134606,5.751921 58.8133588,5.7522708 58.8139814,5.7525902 58.8141765,5.7526975 58.8140988,5.7528367 58.8142489,5.7528855 58.8141395,5.7530237 58.8140426,5.7530887 58.8139626,5.7532758 58.8137942,5.7537936 58.813299,5.7543782 58.8132724,5.7549019 58.8134111,5.7550564 58.8135837,5.7553817 58.8136216,5.7558462 58.8132168,5.7561742 58.8130844,5.7564268 58.8130333,5.7567719 58.8129823,5.7570492 58.8129791,5.757422 58.8129408,5.7577843 58.8129097,5.7579711 58.8128928,5.758835 58.8128154,5.7600586 58.8133112,5.7608494 58.8135401))"),
            NewGeometry = ReadWkt(@"LINESTRING(5.7712508 58.802781,5.770865 58.8026456,5.7702133 58.8024966,5.76941 58.8024191,5.7685507 58.8023804,5.7677233 58.8027656,5.7673653 58.8026567,5.765757 58.8024456,5.7657047 58.8023237,5.7652823 58.8023287,5.7653267 58.8021787,5.7653073 58.8020659,5.7653875 58.801951,5.7655686 58.8018657,5.7658597 58.8018233,5.7660426 58.8017967,5.7660535 58.8017941,5.7664162 58.8017077,5.7665207 58.8016829,5.7665519 58.8016844,5.7671291 58.8016797,5.7673871 58.8016776,5.7675532 58.8015425,5.7676122 58.8014945,5.7677356 58.8011123,5.7677832 58.8009648,5.7678799 58.8006654,5.7683716 58.8,5.768395 58.7999683,5.7683946 58.7999612,5.768392 58.799847,5.768388 58.7996714,5.7682702 58.7995412,5.7682467 58.7995152,5.7681956 58.7993519,5.7681654 58.7992557,5.7681131 58.7990895,5.767896 58.7990031,5.7673671 58.798918,5.7671389 58.7988544,5.7664723 58.7986708,5.766255 58.7985845,5.7662444 58.7985123,5.766428 58.7984001,5.7665091 58.7980876,5.7667881 58.7975777,5.7668666 58.7974155,5.7668956 58.7973287,5.7669467 58.7972316,5.7669396 58.7972247,5.7668498 58.7971416,5.7666846 58.7971047,5.7665355 58.7971229,5.7666053 58.7972777,5.7666142 58.7974092,5.7664045 58.797353,5.7655611 58.7971827,5.7646282 58.7973932,5.7632365 58.7975646,5.7622812 58.7976932,5.7616493 58.7977166,5.7605359 58.7977166,5.7598062 58.7977712,5.7594526 58.7977907,5.7591585 58.7978111,5.7583512 58.7979676,5.7583574 58.7993722,5.7582465 58.8001702,5.7580811 58.8011278,5.7571867 58.8025978,5.7568736 58.8031348,5.7568167 58.8032379,5.7566622 58.8035012,5.7565606 58.8037391,5.7561296 58.804354,5.7557068 58.8049226,5.7548194 58.8051367,5.7545576 58.8051571,5.75426 58.8050058,5.7541194 58.8050023,5.7540354 58.8050002,5.7538252 58.8052106,5.7537529 58.8056133,5.7535457 58.8059765,5.7535431 58.8060398,5.7534972 58.8071287,5.753489 58.8073232,5.7533058 58.8076151,5.7529238 58.8078123,5.7527001 58.8078461,5.7524141 58.8078893,5.7514435 58.8079177,5.751424 58.8079183,5.7513077 58.807973,5.7512428 58.8080036,5.7511215 58.8081893,5.7509445 58.8082298,5.7504649 58.807984,5.7500158 58.8079727,5.7500002 58.8079434,5.7497205 58.807426,5.7493942 58.807211,5.749279 58.8067767,5.7491648 58.8065847,5.7489648 58.8062475,5.7488114 58.8058625,5.7487405 58.8056845,5.7487221 58.8053248,5.7490723 58.8050998,5.7500001 58.8049872,5.7500001 58.8044529,5.7496252 58.8045353,5.749539 58.8045544,5.7493595 58.8046217,5.74885 58.8046988,5.7483628 58.8047224,5.748234 58.8047351,5.7462055 58.8035009,5.746006 58.8034165,5.745738 58.803344,5.7455747 58.8032238,5.7454546 58.8031354,5.745354 58.8030615,5.7452195 58.8029624,5.7452188 58.8029205,5.7452165 58.8028096,5.7454677 58.802717,5.7465601 58.8028884,5.7476794 58.8027728,5.7482496 58.8027872,5.7482497 58.8027711,5.7482537 58.8023739,5.7476763 58.8022515,5.7471043 58.8018865,5.7466763 58.8018308,5.74663 58.8018211,5.7460991 58.8017084,5.7452782 58.8015978,5.7450608 58.8016443,5.7449777 58.8016621,5.7443739 58.8020064,5.7439432 58.8021663,5.7435604 58.8021836,5.7434232 58.8021288,5.7430782 58.8021623,5.7428716 58.8024051,5.7438821 58.8027626,5.7424895 58.8035254,5.7417254 58.8037935,5.74114 58.8038414,5.740412 58.8033327,5.7397166 58.8033595,5.7392819 58.8033665,5.7388429 58.8034972,5.7381797 58.8037004,5.7359942 58.8039906,5.7363719 58.8047941,5.7360638 58.8052616,5.7360188 58.805439,5.733685 58.8060597,5.7330182 58.805579,5.7322523 58.8053316,5.7325406 58.8048322,5.7323875 58.8046782,5.7321 58.8047763,5.7320579 58.8047866,5.7311534 58.8051951,5.7307921 58.8052845,5.7307582 58.8052929,5.7306923 58.8053092,5.7300129 58.805166,5.7288964 58.8043289,5.7286259 58.8042591,5.7284982 58.8042928,5.7282529 58.8043575,5.7266024 58.8050208,5.7260409 58.8054061,5.7270777 58.8058027,5.7292352 58.806659,5.7314307 58.8075229,5.7319403 58.8087546,5.7322614 58.8087197,5.7325042 58.8085358,5.7322379 58.8076581,5.73354 58.8081241,5.7343802 58.8082697,5.7345494 58.8082711,5.7348996 58.808274,5.7354369 58.8084371,5.7356743 58.8085092,5.7363698 58.8088504,5.7368213 58.8090235,5.7370362 58.8090327,5.7372586 58.8090422,5.7373965 58.8089576,5.7374127 58.8089478,5.7375096 58.8088882,5.737641 58.8089034,5.7379035 58.8089341,5.7382936 58.8090248,5.7386402 58.8090246,5.7389707 58.8089572,5.7389931 58.8089527,5.7389945 58.8089547,5.7392732 58.8089238,5.7393502 58.8090201,5.7394127 58.8090981,5.7392439 58.8092376,5.7392536 58.8096873,5.7388711 58.8098842,5.7389124 58.8101819,5.7390929 58.8104741,5.7402413 58.8103597,5.7415329 58.8102296,5.7416748 58.8105757,5.7419805 58.8108109,5.7422425 58.8109692,5.7424433 58.8110777,5.7426442 58.8111636,5.7429499 58.811349,5.7430023 58.8113897,5.7430721 58.8114078,5.7431427 58.8114393,5.7435763 58.8114322,5.7439622 58.8115677,5.7443355 58.8116492,5.7450827 58.8118118,5.7458425 58.8120097,5.7460411 58.8120614,5.7478731 58.8125383,5.7480649 58.812725,5.7484164 58.8130448,5.74869 58.8129781,5.7499527 58.8127332,5.7502641 58.8133196,5.7504462 58.8134742,5.7517457 58.8135297,5.7521141 58.8136532,5.7522708 58.8139814,5.7525902 58.8141765,5.7528855 58.8141395,5.7530237 58.8140426,5.7530887 58.8139626,5.7532758 58.8137942,5.7534404 58.8135323,5.7538234 58.8133582,5.7540755 58.8133534,5.7544118 58.8133244,5.7549019 58.8134111,5.7550936 58.8135372,5.7555734 58.8134077,5.7558462 58.8132168,5.7561742 58.8130844,5.7564268 58.8130333,5.7567719 58.8129823,5.7570452 58.8129311,5.7585883 58.8127332,5.7597067 58.8128871,5.7601186 58.8127566,5.7598967 58.8125354,5.759092 58.8122455,5.7590735 58.8120743,5.7593205 58.8120266,5.7593558 58.8119457,5.758379 58.8116561,5.7569421 58.8112126,5.7567156 58.8110714,5.7560502 58.8112801,5.7559389 58.8113214,5.7555422 58.8113024,5.7554113 58.8112183,5.7554467 58.8111044,5.7554612 58.8110577,5.7555443 58.8110171,5.7559694 58.8108099,5.7561857 58.8107532,5.7575676 58.8103917,5.758127 58.8105226,5.7585647 58.8106594,5.759179 58.8109445,5.7597033 58.8110835,5.7599655 58.8110541,5.7599968 58.811033,5.7601692 58.8109154,5.7601678 58.8107446,5.760113 58.8106623,5.7600767 58.8106076,5.7601149 58.8103838,5.7606691 58.8102,5.7612347 58.8100794,5.7616712 58.8098567,5.7620999 58.8099034,5.7622674 58.809872,5.7623704 58.8098527,5.7624829 58.8096973,5.763361 58.8091981,5.7639083 58.8088337,5.7646378 58.809106,5.7664725 58.8103172,5.7669461 58.8100861,5.7689729 58.8099499,5.7709699 58.8097124,5.7719981 58.8094595,5.7727203 58.809145,5.7728019 58.8090123,5.7726884 58.8089286,5.772592 58.8089074,5.7723659 58.8088576,5.7723223 58.8087905,5.7716537 58.8077612,5.7707761 58.8072626,5.7690271 58.80612,5.7689897 58.8057524,5.7691485 58.8055299,5.7702506 58.8055395,5.7707643 58.8053702,5.7711846 58.8050316)")
        },
        new GeomPair()
        {
            Name = "polygon, modify",
            OldGeometry = ReadWkt("POLYGON((0 0, 0 1, 1 1, 1 0, 0 0))"),
            NewGeometry = ReadWkt("POLYGON((0 0, 0 2, 1 1, 1 0, 0 0))")
        },
        new GeomPair()
        {
            Name = "polygon, modify add ring",
            OldGeometry = ReadWkt("POLYGON((0 0, 0 10, 10 10, 10 0, 0 0))"),
            NewGeometry = ReadWkt("POLYGON((0 0, 0 10, 10 10, 10 0, 0 0), (2 2, 2 3, 3 3, 3 2, 2 2))")
        },
        new GeomPair()
        {
            Name = "polygon, modify remove ring",
            OldGeometry = ReadWkt("POLYGON((0 0, 0 10, 10 10, 10 0, 0 0), (2 2, 2 3, 3 3, 3 2, 2 2))"),
            NewGeometry = ReadWkt("POLYGON((0 0, 0 10, 10 10, 10 0, 0 0))")
        },
        new GeomPair()
        {
            Name = "polygon, modify rings",
            OldGeometry = ReadWkt("POLYGON((0 0, 1 1, 2 2, 0 0), (3 3, 4 4, 5 5, 3 3), (5 5, 6 6, 7 7, 5 5), (7 7, 8 8, 10 10, 7 7))"),
            NewGeometry = ReadWkt("POLYGON((0 0, 1 1, 2 2, 0 0), (3 3, 3 4, 5 5, 3 3), (10 10, 11 11, 12 12, 10 10), (5 5, 6 6, 7 7, 5 5), (7 7, 8 8, 10 10, 7 7))")
        },
        new GeomPair()
        {
            Name = "polygon, modify all",
            OldGeometry = ReadWkt("POLYGON((0 0, 1 0, 1 1, 0 1, 0 0))"),
            NewGeometry = ReadWkt("POLYGON((1 0, 1 0, 1 1, 0 1, 1 0))")
        },
        new GeomPair()
        {
            Name = "polygon, complex",
            OldGeometry = ReadWkt("POLYGON((0 0, 100 0, 100 100, 0 100, 0 0), (1 1, 2 1, 2 2, 1 2, 1 1), (60 60, 61 60, 61 61, 60 61, 60 60), (20 20, 25 25, 20 25, 20 20))"),
            NewGeometry = ReadWkt("POLYGON((0 0, 100 0, 100 100, 0 100, 0 0), (10 10, 20 10, 20 20, 10 20, 10 10 ), (1 1, 2.5 1.5, 2.5 2.5, 1.5 2.5, 1 1), (60 60, 61 60, 61 61, 60 61, 60 60), (20 20, 25 25, 20 25, 20 20))")
        },
        new GeomPair()
        {
            Name = "polygon, insert",
            OldGeometry = null,
            NewGeometry = ReadWkt("POLYGON((1 1, 2 1, 2 2, 1 2, 1 1))")
        },
        new GeomPair()
        {
            Name = "polygon, delete",
            OldGeometry = ReadWkt("POLYGON((1 1, 2 1, 2 2, 1 2, 1 1))"),
            NewGeometry = null
        },
        new GeomPair()
        {
            Name = "polygon, real life 1",
            OldGeometry = ReadWkt(@"POLYGON((
            10.612732153367396 63.299974967656695,
            10.612744348557145 63.29995048835496,
            10.612742809869498 63.299944253776886,
            10.612744573451742 63.29993264794175,
            10.61273871806378 63.29986784829157,
            10.612732153367396 63.299810799030226,
            10.61218103695473 63.29986884341021,
            10.610768363739918 63.299957872198156,
            10.610644941647156 63.29996204928202,
            10.610443894842021 63.299970552065105,
            10.612053096806594 63.29988752060812,
            10.612269017987117 63.29989423809266,
            10.612414944996427 63.29987152555136,
            10.61243435573188 63.2998751098488,
            10.612732153367396 63.299974967656695
            ))"),
            NewGeometry = ReadWkt(@"POLYGON((
            10.612732153367396 63.299974967656695,
            10.612741873152487 63.299949824499784,
            10.612742809869498 63.299944253776886,
            10.612732153367396 63.299810799030226,
            10.61218103695473 63.29986884341021,
            10.610768363739918 63.299957872198156,
            10.610443894842021 63.299970552065105,
            10.61198140363693 63.299903616566574,
            10.612269017987117 63.29989423809266,
            10.612414944996427 63.29987152555136,
            10.61243435573188 63.2998751098488,
            10.612732153367396 63.299974967656695
            ))")
        },
        new GeomPair()
        {
            Name = "MultiPoint modify",
            OldGeometry = ReadWkt("MULTIPOINT((1 2), (1 1))"),
            NewGeometry = ReadWkt("MULTIPOINT((1 1), (2 1))")
        },
        new GeomPair()
        {
            Name = "MultiPoint add and modify",
            OldGeometry = ReadWkt("MULTIPOINT((1 1), (2 1), (2 2))"),
            NewGeometry = ReadWkt("MULTIPOINT((1 1), (1 1), (2 2), (3 3))")
        },
        new GeomPair()
        {
            Name = "MultiPoint remove and modify",
            OldGeometry = ReadWkt("MULTIPOINT((1 1), (2 1), (2 2), (3 3))"),
            NewGeometry = ReadWkt("MULTIPOINT((1 1), (1 1), (2 2))")
        },
        new GeomPair()
        {
            Name = "MultiPoint insert",
            OldGeometry = null,
            NewGeometry = ReadWkt("MULTIPOINT((1 1), (1 1), (2 2))")
        },
        new GeomPair()
        {
            Name = "MultiPoint delete",
            OldGeometry = ReadWkt("MULTIPOINT((1 1), (1 1), (2 2))"),
            NewGeometry = null
        },
        new GeomPair()
        {
            Name = "MultiLinestring modify",
            OldGeometry = ReadWkt("MULTILINESTRING((0 0, 0 1, 1 1, 1 0, 10 10))"),
            NewGeometry = ReadWkt("MULTILINESTRING((0 0, 0 2, 1 1, 1 0, 10 10))")
        },
        new GeomPair()
        {
            Name = "MultiLinestring add ring",
            OldGeometry = ReadWkt("MULTILINESTRING((0 0, 0 10, 10 10, 10 0, 10 10))"),
            NewGeometry = ReadWkt("MULTILINESTRING((0 0, 0 10, 10 10, 10 0, 10 10), (2 2, 2 3, 3 3, 3 2, 20 20))")
        },
        new GeomPair()
        {
            Name = "MultiLinestring remove ring",
            OldGeometry = ReadWkt("MULTILINESTRING((0 0, 0 10, 10 10, 10 0, 10 10), (2 2, 2 3, 3 3, 3 2, 20 20))"),
            NewGeometry = ReadWkt("MULTILINESTRING((0 0, 0 10, 10 10, 10 0, 10 10))")
        },
        new GeomPair()
        {
            Name = "MultiLinestring insert modify",
            OldGeometry = ReadWkt("MULTILINESTRING((0 0, 1 1, 2 2, 10 10), (3 3, 4 4, 5 5, 30 30), (5 5, 6 6, 7 7, 50 50), (7 7, 8 8, 10 10, 70 70))"),
            NewGeometry = ReadWkt("MULTILINESTRING((0 0, 1 1, 2 2, 10 10), (3 3, 3 4, 5 5, 30 30), (10 10, 11 11, 12 12, 100 100), (5 5, 6 6, 7 7, 50 50), (7 7, 8 8, 10 10, 70 70))")
        },
        new GeomPair()
        {
            Name = "MultiLinestring insert",
            OldGeometry = null,
            NewGeometry = ReadWkt("MULTILINESTRING((0 0, 0 10, 10 10, 10 0, 10 10), (2 2, 2 3, 3 3, 3 2, 20 20))")
        },
        new GeomPair()
        {
            Name = "MultiLinestring delete",
            OldGeometry = ReadWkt("MULTILINESTRING((0 0, 0 10, 10 10, 10 0, 10 10), (2 2, 2 3, 3 3, 3 2, 20 20))"),
            NewGeometry = null
        },
        new GeomPair()
        {
            Name = "Multipolygon modify",
            OldGeometry = ReadWkt("MULTIPOLYGON(((0 0, 1 0, 1 1, 0 1, 0 0)), ((10 10, 11 10, 11 11, 10 11, 10 10)))"),
            NewGeometry = ReadWkt("MULTIPOLYGON(((1 0, 1 0, 1 1, 0 1, 1 0)), ((10 10, 11 10, 11 11, 10 11, 10 10)))")
        },
        new GeomPair()
        {
            Name = "Multipolygon modify add",
            OldGeometry = ReadWkt("MULTIPOLYGON(((0 0, 100 0, 100 100, 0 100, 0 0)), ((1 1, 2 1, 2 2, 1 2, 1 1)), ((60 60, 61 60, 61 61, 60 61, 60 60)), ((20 20, 25 25, 20 25, 20 20)))"),
            NewGeometry = ReadWkt("MULTIPOLYGON(((0 0, 100 0, 100 100, 0 100, 0 0)), ((10 10, 20 10, 20 20, 10 20, 10 10 )), ((1 1, 2.5 1.5, 2.5 2.5, 1.5 2.5, 1 1)), ((60 60, 61 60, 61 61, 60 61, 60 60)), ((20 20, 25 25, 20 25, 20 20)))")
        },
        new GeomPair()
        {
            Name = "Multipolygon modify add 2",
            OldGeometry = ReadWkt("MULTIPOLYGON(((0 0, 100 0, 100 100, 0 100, 0 0)), ((1 1, 2 1, 2 2, 1 2, 1 1)), ((60 60, 61 60, 61 61, 60 61, 60 60)), ((20 20, 25 25, 20 25, 20 20)))"),
            NewGeometry = ReadWkt("MULTIPOLYGON(((0 0, 100 0, 100 100, 0 100, 0 0)), ((1 1, 2.5 1.5, 2.5 2.5, 1.5 2.5, 1 1)), ((10 10, 20 10, 20 20, 10 20, 10 10 )), ((60 60, 61 60, 61 61, 60 61, 60 60)), ((20 20, 25 25, 20 25, 20 20)))")
        },
        new GeomPair()
        {
            Name = "Multipolygon insert",
            OldGeometry = null,
            NewGeometry = ReadWkt("MULTIPOLYGON(((0 0, 1 0, 1 1, 0 1, 0 0)), ((10 10, 11 10, 11 11, 10 11, 10 10)))")
        },
        new GeomPair()
        {
            Name = "Multipolygon delete",
            OldGeometry = ReadWkt("MULTIPOLYGON(((0 0, 1 0, 1 1, 0 1, 0 0)), ((10 10, 11 10, 11 11, 10 11, 10 10)))"),
            NewGeometry = null
        },
    };

        [Test]
        public void TestDiffer()
        {

            foreach (var geomPair in pairs)
            {
                var oldGeom = geomPair.OldGeometry;
                var newGeom = geomPair.NewGeometry;
                var diff = Differ.CreateDiff(oldGeom, newGeom);

                var patched = diff.Apply(oldGeom);
                Assert.AreEqual(WriteWkt(newGeom), WriteWkt(patched), $"Patch {geomPair.Name}");

                var unpatched = diff.Undo(newGeom);
                Assert.AreEqual(WriteWkt(oldGeom), WriteWkt(unpatched), $"UnPatch {geomPair.Name}");

            }
        }

        [Test]
        public void TestBinaryDiffer()
        {

            foreach (var geomPair in pairs)
            {
                var oldGeom = geomPair.OldGeometry;
                var newGeom = geomPair.NewGeometry;
                var diff = GeometryDifferBinary.Diff(oldGeom, newGeom);

                var patched = GeometryDifferBinary.Patch(oldGeom, diff); 
                Assert.AreEqual(WriteWkt(newGeom, 3), WriteWkt(patched, 3), $"Patch {geomPair.Name}");

                var unpatched = GeometryDifferBinary.UnPatch(newGeom, diff);
                Assert.AreEqual(WriteWkt(oldGeom, 3), WriteWkt(unpatched, 3), $"UnPatch {geomPair.Name}");

            }
        }

        [Test]
        public void TestReadLineStringWithZ()
        {
            var oldGeometry = ReadWkt("LINESTRING(0 0 0, 2 2 1, 3 3, 4 4)");
            var newGeometry = ReadWkt("LINESTRING(0 0 1, 2 2 2, 3 3, 4 4)");
            var diff = GeometryDifferBinary.Diff(oldGeometry, newGeometry);

            var patched = GeometryDifferBinary.Patch(oldGeometry, diff);

            var a = WriteWkt(newGeometry, 3);
            var b = WriteWkt(patched, 3);
            Assert.AreEqual(a, b);
        }

    }
}
